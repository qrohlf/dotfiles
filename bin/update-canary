#!/bin/zsh
set -euo pipefail
IFS=$'\n\t'

canary_branch=${1:-"$CANARY_TRACKING_BRANCH"}
canary_name=${2:-"$(echo $canary_branch | sed -r 's/[^a-zA-Z0-9]+/-/g')"}

aws-login
/Users/qrohlf/Code/strava/configuration/mesos/tools/paasage app /Users/qrohlf/Code/strava/configuration/mesos/services/active/conf/canary/canary.conf deploy --no-diff name="$canary_name" branch="$canary_branch"
osascript -e "display notification \"Canary: $canary_name\" with title \"âœ… Deploy of $canary_branch complete\""
